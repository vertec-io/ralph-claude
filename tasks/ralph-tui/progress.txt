# Ralph Progress Log
Effort: ralph-tui
Type: Feature
Started: 2026-01-17
---

## Codebase Patterns
- Rust TUI uses ratatui + crossterm for terminal handling
- Always enable_raw_mode() and EnterAlternateScreen at startup, disable_raw_mode() and LeaveAlternateScreen at exit
- Use portable-pty crate for PTY subprocess management
- Build with `cargo build --release` from ralph-tui/ directory
- Use vt100 crate for terminal emulation (ANSI escape code interpretation)
- Access vt100 screen via `parser.screen()` for reading, `parser.screen_mut()` for resizing
- Convert vt100::Color to ratatui::Color (Default->Reset, Idx->Indexed, Rgb->Rgb)
- Modal input: Mode enum controls input handling; match on mode in event loop

---

## 2026-01-17 - US-006
- Implemented: Modal input system with Ralph/Claude modes
- Files changed:
  - ralph-tui/src/main.rs - added Mode enum, mode field to App, mode switching with i/Tab/Esc, visual indicators
  - tasks/ralph-tui/prd.json - marked US-006 as passes: true
- **Learnings for future iterations:**
  - Mode enum with Ralph (default) and Claude variants controls input handling
  - Use match on app.mode in input handling to determine behavior per mode
  - Visual indicators: [ACTIVE] suffix in panel title, green bold border for active panel, gray for inactive
  - Status bar text changes based on mode (Ralph shows all controls, Claude shows "Press Esc to return")
  - 'i' and Tab both switch to Claude mode; Escape switches back to Ralph mode
  - 'q' only quits in Ralph mode (future: keys forwarded to PTY in Claude mode)
---

## 2026-01-17 - US-005
- Implemented: PTY output rendering with ANSI escape code interpretation using vt100 crate
- Files changed:
  - ralph-tui/Cargo.toml - added vt100 = "0.16" dependency, upgraded ratatui to 0.30 for compatibility
  - ralph-tui/Cargo.lock - updated with new dependencies
  - ralph-tui/src/main.rs - replaced raw output buffer with vt100::Parser, added render_vt100_screen() function
  - tasks/ralph-tui/prd.json - marked US-005 as passes: true
- **Learnings for future iterations:**
  - vt100::Parser::new(rows, cols, scrollback_len) creates terminal emulator
  - Feed PTY output bytes to parser via parser.process(&bytes)
  - parser.screen() returns immutable Screen reference
  - parser.screen_mut().set_size(rows, cols) for resizing
  - screen.cell(row, col) returns Option<&Cell> with text and styling
  - Cell has fgcolor(), bgcolor(), bold(), italic(), underline(), inverse() methods
  - Handle is_wide_continuation() cells by skipping them (wide chars take 2 columns)
  - vt100 handles auto-scroll internally - just render the visible screen
  - ratatui 0.30 needed to resolve unicode-width version conflict with vt100
---

## 2026-01-17 - US-004
- Implemented: PTY subprocess management using portable-pty
- Files changed:
  - ralph-tui/src/main.rs - added PTY creation, spawning bash, output capture to buffer, cleanup, and resize handling
  - tasks/ralph-tui/prd.json - marked US-004 as passes: true
- **Learnings for future iterations:**
  - Use `native_pty_system()` to get the system-appropriate PTY implementation
  - `openpty(PtySize { rows, cols, ... })` creates the PTY pair
  - Drop `pair.slave` after spawning to allow proper EOF detection
  - Use `try_clone_reader()` to get a reader that can be moved to another thread
  - Background thread reads PTY output into shared buffer (Arc<Mutex<PtyState>>)
  - Limit buffer size to prevent memory issues (keep last 50KB when buffer exceeds 100KB)
  - PTY resize via `master.resize(PtySize { ... })` on terminal resize events
  - Proper cleanup order: wait for child, drop master PTY, join reader thread
  - Poll for input every 50ms for responsive UI
---

## 2026-01-17 - US-003
- Implemented: Basic two-panel layout with Ralph Status (30%) and Claude Code (70%) panels
- Files changed:
  - ralph-tui/src/main.rs - implemented split layout with Layout constraints, added bottom bar
  - tasks/ralph-tui/prd.json - marked US-003 as passes: true
- **Learnings for future iterations:**
  - Use Layout::default().direction(Direction::Vertical/Horizontal) for splitting areas
  - Constraint::Percentage(n) for proportional sizing, Constraint::Length(n) for fixed sizes
  - Constraint::Min(n) ensures minimum height for dynamic areas
  - Paragraph widget with custom Style for status bar (fg/bg colors)
  - Layout resizing is automatic when using percentage/min constraints
---

## 2026-01-17 - US-002
- Implemented: Initialize Rust project with ratatui and dependencies
- Files changed:
  - ralph-tui/Cargo.toml - project config with metadata and all dependencies
  - ralph-tui/Cargo.lock - dependency lockfile
  - ralph-tui/src/main.rs - basic TUI showing "Hello Ralph" with quit on 'q'
  - .gitignore - added ralph-tui/target/
  - tasks/ralph-tui/prd.json - marked US-002 as passes: true
- **Learnings for future iterations:**
  - TUI apps can't be easily tested in non-interactive mode (raw terminal requirements)
  - ratatui 0.29 uses frame.area() instead of frame.size()
  - Cargo edition 2024 is supported on current Rust toolchain
  - Binary output is at ralph-tui/target/release/ralph-tui (~848KB)
---

## 2026-01-17 - US-001
- Implemented: Split ralph.sh into non-interactive and legacy interactive versions
- Files changed:
  - ralph.sh - removed all tmux/interactive code (~300 lines removed)
  - ralph-i.sh - new file containing interactive tmux functionality
  - tasks/ralph-tui/prd.json - marked US-001 as passes: true
- **Learnings for future iterations:**
  - ralph.sh is now a clean non-interactive loop (simpler foundation for ralph-tui)
  - ralph-i.sh is the legacy interactive mode using tmux
  - Both scripts share the same core functionality (task selection, progress rotation, iteration loop)
  - The split allows ralph-tui to eventually replace ralph-i.sh as the primary interactive mode
---
